define("piece",["knockout"],function(e){var t=function(){this.x=e.observable();this.y=e.observable();this.left=e.observable();this.top=e.observable();this.right=e.observable();this.bottom=e.observable();this.image=e.observable();this.marginX=e.observable(0);this.marginY=e.observable(0);this.css=e.computed(function(){return{left:this.left()===1,top:this.top()===1,right:this.right()===1,bottom:this.bottom()===1}},this)};t.prototype.setParameters=function(e,t,n,r,i,s){this.x(e);this.y(t);this.left(n!==0?-n.right():0);this.top(r!==0?-r.bottom():0);this.right(i);this.bottom(s)};t.prototype.setImage=function(e){this.image(e)};t.prototype.setDistance=function(e){this.marginX(e.left);this.marginY(e.top)};return t});define("puzzle",["knockout","piece"],function(e,t){var n=function(){this.pieces=e.observableArray()};n.prototype.setNumPieces=function(n,r){var i=this;this.numRowPieces=n;this.numColPieces=r;var s=function(){return Math.floor(Math.random()*2)===1?1:-1};this.pieces([]);e.utils.arrayForEach(e.utils.range(0,n-1),function(o){var u=e.observableArray([]);e.utils.arrayForEach(e.utils.range(0,r-1),function(e){var a=new t;a.setParameters(o,e,e===0?0:u()[e-1],o===0?0:i.getPiece(o-1,e),e===r-1?0:s(),o===n-1?0:s());u.push(a)});i.pieces.push(u)})};n.prototype.getPiece=function(e,t){return this.pieces()[e]()[t]};n.prototype.switchPiece=function(e,t,n,r){var i=this.getPiece(n,r),s=this.getPiece(e,t);this.setPiece(n,r,s);this.setPiece(e,t,i)};return n});define("puzzlify",["knockout","jquery","puzzle","piece"],function(e,t,n,r){function i(t,r,i,s,o,u){this.images=e.observableArray([]);this.imageName=t;this.originalSize={width:r,height:i};this.numRowPieces=e.observable(s);this.numColPieces=e.observable(o);this.callback=u;this.puzzle=new n}i.prototype.createPuzzle=function(){var e=this;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.originalImage=new Image;this.originalImage.onload=function(){e.initOnImageLoad()};this.originalImage.src=this.imageName};i.prototype.initOnImageLoad=function(){this.canvas.width=this.originalImage.width;this.canvas.height=this.originalImage.height;this.puzzle.setNumPieces(this.numRowPieces(),this.numColPieces());var e=this.canvas.width/this.numRowPieces(),t=this.canvas.height/this.numColPieces();this.context.drawImage(this.originalImage,0,0);this.distance={left:this.originalSize.width/this.originalImage.width*85,top:this.originalSize.height/this.originalImage.height*85};var n=[];for(var r=0;r<this.numRowPieces();r++){for(var i=0;i<this.numColPieces();i++){var s=this.puzzle.getPiece(r,i);var o=this.createPiece({left:s.left(),top:s.top(),right:s.right(),bottom:s.bottom()},{x:i,y:r},e,t);var u=document.createElement("canvas");u.width=o.width/e*this.originalSize.width/this.numRowPieces();u.height=o.height/t*this.originalSize.height/this.numColPieces();var a=u.getContext("2d");a.drawImage(o,0,0,u.width,u.height);s.setImage(u.toDataURL());s.setDistance(this.distance);var f=Math.floor(Math.random()*n.length);n.splice(f,0,s)}}this.callback(n)};i.prototype.createPiece=function(e,t,n,r){var i=(e.left===1?1:0)+(e.right===1?1:0);var s=(e.top===1?1:0)+(e.bottom===1?1:0);var o=document.createElement("canvas");var u=o.getContext("2d");var a=35,f=15;var l={circleRadius:a,circleDistance:f,mainRectLeft:e.left===1?f+2*a:0,mainRectTop:e.top===1?f+2*a:0,mainRectWidth:n,mainRectHeight:r};l.mainRectRight=l.mainRectLeft+l.mainRectWidth;l.mainRectBottom=l.mainRectTop+l.mainRectHeight;o.width=n+i*(2*a+f);o.height=r+s*(2*a+f);u.fillStyle="blue";u.rect(l.mainRectLeft,l.mainRectTop,l.mainRectWidth,l.mainRectHeight);u.fill();this.updatePieceLeft(e.left,o,u,l);this.updatePieceTop(e.top,o,u,l);this.updatePieceRight(e.right,o,u,l);this.updatePieceBottom(e.bottom,o,u,l);u.save();u.beginPath();u.globalCompositeOperation="source-in";u.drawImage(this.canvas,-t.x*n+l.mainRectLeft,-t.y*r+l.mainRectTop);u.restore();return o};i.prototype.updatePieceLeft=function(e,t,n,r){n.save();var i,s,o=r.mainRectTop+r.mainRectHeight/2,u,a;switch(e){case-1:i=Math.PI*.25;s=r.mainRectLeft+r.circleDistance+r.circleRadius;a=Math.abs(Math.sin(i)*r.circleRadius);u=Math.abs(Math.cos(i)*r.circleRadius);n.beginPath();n.globalCompositeOperation="destination-out";n.moveTo(s,o);n.arc(s,o,r.circleRadius,Math.PI+i,Math.PI-i,false);n.rect(r.mainRectLeft,o-a,2*u,r.circleRadius+r.circleDistance);n.fill();n.beginPath();n.globalCompositeOperation="destination-over";n.moveTo(r.mainRectLeft,o-a-2);n.quadraticCurveTo(r.mainRectLeft,o,s-u,o-a-2);n.moveTo(r.mainRectLeft,o+a+2);n.quadraticCurveTo(r.mainRectLeft,o,s-u,o+a+2);n.fill();break;case 0:break;case 1:i=Math.PI*.25;s=r.circleRadius;a=Math.abs(Math.sin(i)*r.circleRadius);u=Math.abs(Math.cos(i)*r.circleRadius);n.beginPath();n.moveTo(s,o);n.arc(s,o,r.circleRadius,i,-i,false);n.rect(r.circleRadius,o-a,2*u+1,r.circleRadius+r.circleDistance);n.fill();n.beginPath();n.globalCompositeOperation="destination-out";n.moveTo(r.mainRectLeft,o-a-1);n.quadraticCurveTo(r.mainRectLeft,o,s+u-1,o-a-1);n.moveTo(r.mainRectLeft,o+a+1);n.quadraticCurveTo(r.mainRectLeft,o,s+u-1,o+a+1);n.fill();break}n.restore()};i.prototype.updatePieceTop=function(e,t,n,r){n.save();var i,s=r.mainRectLeft+r.mainRectWidth/2,o,u,a;switch(e){case-1:i=Math.PI*.25;o=r.mainRectTop+r.circleRadius+r.circleDistance;a=Math.abs(Math.sin(i)*r.circleRadius);u=Math.abs(Math.cos(i)*r.circleRadius);n.beginPath();n.globalCompositeOperation="destination-out";n.moveTo(s,o);n.arc(s,o,r.circleRadius,-i,Math.PI+i,false);n.rect(s-u,r.mainRectTop,2*u,r.circleRadius+r.circleDistance);n.fill();n.beginPath();n.globalCompositeOperation="destination-over";n.moveTo(s-r.circleRadius,r.mainRectTop);n.quadraticCurveTo(s,r.mainRectTop,s-u,r.mainRectTop+a);n.moveTo(s+r.circleRadius,r.mainRectTop);n.quadraticCurveTo(s,r.mainRectTop,s+u,r.mainRectTop+a);n.fill();break;case 0:break;case 1:i=Math.PI*.75;o=r.circleRadius;a=Math.abs(Math.sin(i)*r.circleRadius);u=Math.abs(Math.cos(i)*r.circleRadius);n.beginPath();n.moveTo(s,o);n.arc(s,o,r.circleRadius,i,Math.PI-i,false);n.rect(s-u,r.mainRectTop-r.circleRadius-r.circleDistance,2*u,r.circleRadius+r.circleDistance);n.fill();n.beginPath();n.globalCompositeOperation="destination-out";n.moveTo(s-r.circleRadius,r.mainRectTop);n.quadraticCurveTo(s,r.mainRectTop,s-u,r.mainRectTop-a);n.moveTo(s+r.circleRadius,r.mainRectTop);n.quadraticCurveTo(s,r.mainRectTop,s+u,r.mainRectTop-a);n.fill();break}n.restore()};i.prototype.updatePieceRight=function(e,t,n,r){n.save();var i,s,o=r.mainRectTop+r.mainRectHeight/2,u,a;switch(e){case-1:i=Math.PI*.25;s=r.mainRectRight-r.circleDistance-r.circleRadius;a=Math.abs(Math.sin(i)*r.circleRadius);u=Math.abs(Math.cos(i)*r.circleRadius);n.beginPath();n.globalCompositeOperation="destination-out";n.moveTo(s,o);n.arc(s,o,r.circleRadius,i,-i,false);n.rect(r.mainRectRight-r.circleRadius-r.circleDistance,o-a,2*u+1,r.circleRadius+r.circleDistance);n.fill();n.beginPath();n.globalCompositeOperation="destination-over";n.moveTo(r.mainRectRight,o-a-1);n.quadraticCurveTo(r.mainRectRight,o,s+u-1,o-a-1);n.moveTo(r.mainRectRight,o+a+1);n.quadraticCurveTo(r.mainRectRight,o,s+u-1,o+a+1);n.fill();break;case 0:break;case 1:i=Math.PI*.75;s=r.mainRectRight+r.circleDistance+r.circleRadius;a=Math.abs(Math.sin(i)*r.circleRadius);u=Math.abs(Math.cos(i)*r.circleRadius);n.beginPath();n.moveTo(s,o);n.arc(s,o,r.circleRadius,-i,i,false);n.rect(r.mainRectRight,o-a,2*u,r.circleRadius+r.circleDistance);n.fill();n.beginPath();n.globalCompositeOperation="destination-out";n.moveTo(r.mainRectRight,o-a-1);n.quadraticCurveTo(r.mainRectRight,o,s-u+1,o-a-1);n.moveTo(r.mainRectRight,o+a+1);n.quadraticCurveTo(r.mainRectRight,o,s-u+1,o+a+1);n.fill();break}n.restore()};i.prototype.updatePieceBottom=function(e,t,n,r){n.save();var i,s=r.mainRectLeft+r.mainRectWidth/2,o,u,a;switch(e){case-1:i=Math.PI*.25;o=r.mainRectBottom-r.circleRadius-r.circleDistance;a=Math.abs(Math.sin(i)*r.circleRadius);u=Math.abs(Math.cos(i)*r.circleRadius);n.beginPath();n.globalCompositeOperation="destination-out";n.moveTo(s,o);n.arc(s,o,r.circleRadius,Math.PI-i,i,false);n.rect(s-u,r.mainRectBottom-r.circleRadius-r.circleDistance,2*u,r.circleRadius+r.circleDistance);n.fill();n.beginPath();n.globalCompositeOperation="destination-over";n.moveTo(s-r.circleRadius,r.mainRectBottom);n.quadraticCurveTo(s,r.mainRectBottom,s-u,r.mainRectBottom-a);n.moveTo(s+r.circleRadius,r.mainRectBottom);n.quadraticCurveTo(s,r.mainRectBottom,s+u,r.mainRectBottom-a);n.fill();break;case 0:break;case 1:i=Math.PI*.25;o=r.mainRectBottom+r.circleRadius+r.circleDistance;a=Math.abs(Math.sin(i)*r.circleRadius);u=Math.abs(Math.cos(i)*r.circleRadius);n.beginPath();n.moveTo(s,o);n.arc(s,o,r.circleRadius,-i,Math.PI+i,false);n.rect(s-u,r.mainRectBottom,2*u,r.circleRadius+r.circleDistance);n.fill();n.beginPath();n.globalCompositeOperation="destination-out";n.moveTo(s-r.circleRadius,r.mainRectBottom);n.quadraticCurveTo(s,r.mainRectBottom,s-u,r.mainRectBottom+a);n.moveTo(s+r.circleRadius,r.mainRectBottom);n.quadraticCurveTo(s,r.mainRectBottom,s+u,r.mainRectBottom+a);n.fill();break}n.restore()};return i})